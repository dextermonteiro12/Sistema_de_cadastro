============================= test session starts =============================
platform win32 -- Python 3.14.2, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\fmonteiro\Documents\sistema_cadastro\api-gateway\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\fmonteiro\Documents\sistema_cadastro
configfile: pytest.ini
plugins: anyio-4.12.1, Faker-40.4.0, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 19 items

tests\test_api.py::TestHealthEndpoints::test_root_endpoint PASSED        [  5%]
tests\test_api.py::TestHealthEndpoints::test_health_endpoint PASSED      [ 10%]
tests\test_api.py::TestAuthEndpoints::test_login_success PASSED          [ 15%]
tests\test_api.py::TestAuthEndpoints::test_login_failure PASSED          [ 21%]
tests\test_api.py::TestClientesPendentesEndpoint::test_clientes_pendentes_sem_config_key PASSED [ 26%]
tests\test_api.py::TestClientesPendentesEndpoint::test_clientes_pendentes_com_config_key_valida FAILED [ 31%]
tests\test_api.py::TestUtilityEndpoints::test_gerar_clientes_endpoint PASSED [ 36%]
tests\test_api.py::TestUtilityEndpoints::test_monitoramento_endpoint PASSED [ 42%]
tests\test_api.py::TestUtilityEndpoints::test_movimentacoes_endpoint PASSED [ 47%]
tests\test_api.py::TestAmbienteEndpoints::test_check_ambiente_sem_config PASSED [ 52%]
tests\test_api.py::TestAmbienteEndpoints::test_setup_ambiente_sem_config PASSED [ 57%]
tests\test_api.py::TestgRPCEndpoints::test_grpc_gerar_clientes_sem_config PASSED [ 63%]
tests\test_endpoints.py::TestUtilityEndpoints::test_gerar_clientes_endpoint PASSED [ 68%]
tests\test_endpoints.py::TestUtilityEndpoints::test_monitoramento_endpoint PASSED [ 73%]
tests\test_endpoints.py::TestUtilityEndpoints::test_movimentacoes_endpoint PASSED [ 78%]
tests\test_endpoints.py::TestAmbienteEndpoints::test_check_ambiente_sem_config PASSED [ 84%]
tests\test_endpoints.py::TestAmbienteEndpoints::test_setup_ambiente_sem_config PASSED [ 89%]
tests\test_endpoints.py::TestgRPCEndpoints::test_grpc_gerar_clientes_sem_config PASSED [ 94%]
tests\test_endpoints.py::TestgRPCEndpoints::test_grpc_job_status PASSED  [100%]

================================== FAILURES ===================================
_ TestClientesPendentesEndpoint.test_clientes_pendentes_com_config_key_valida _
tests\test_api.py:61: in test_clientes_pendentes_com_config_key_valida
    assert response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stderr call -----------------------------
ERROR:database:Session maker não encontrado: test-config
ERROR:main:Erro ao consultar clientes pendentes: Configuração não encontrada: test-config
INFO:httpx:HTTP Request: POST http://testserver/api/clientes-pendentes "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call ------------------------------
ERROR    database:database.py:127 Session maker não encontrado: test-config
ERROR    main:main.py:204 Erro ao consultar clientes pendentes: Configuração não encontrada: test-config
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/clientes-pendentes "HTTP/1.1 500 Internal Server Error"
============================== warnings summary ===============================
.venv\Lib\site-packages\strawberry\experimental\pydantic\_compat.py:26
  C:\Users\fmonteiro\Documents\sistema_cadastro\api-gateway\.venv\Lib\site-packages\strawberry\experimental\pydantic\_compat.py:26: UserWarning: Core Pydantic V1 functionality isn't compatible with Python 3.14 or greater.
    from pydantic.v1 import BaseModel as BaseModelV1

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests\test_api.py::TestClientesPendentesEndpoint::test_clientes_pendentes_com_config_key_valida - assert 500 == 200
 +  where 500 = <Response [500 Internal Server Error]>.status_code
=================== 1 failed, 18 passed, 1 warning in 2.70s ===================
